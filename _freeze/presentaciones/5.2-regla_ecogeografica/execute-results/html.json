{
  "hash": "13d02f1ad080411dfd927cf9b7300857",
  "result": {
    "markdown": "---\ntitle: \"Regla de Rapoport y otras patrones\"\nauthor: Axel Arango & Fabricio Villalobos\nformat: revealjs\neditor: visual\n---\n\n\n\n## Regla de Rapoport\n\n> \"Relación positiva entre latitud y tamaño de área de distribución\" G. Stevens\n\n-   En este ejercicio se probará la regla de Rapoport en un set de más de 6000 registros para especies de la familia *Icteridae* (Aves: Passeriformes) y se compararán los procedimientos utilizando dos paqueterías: `letsR` y EcoPhylo Mapper `epm`\n\n`epm` utiliza los paquetes `sf` y `terra` para análisis espaciales, lo cuál será útil cuándo `rgdal` y `raster` se hayan descontinuado (a partir de ya! junio 2023)\n\n## Paquetes necesarios:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(epm)\nlibrary(rgdal)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: sp\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe legacy packages maptools, rgdal, and rgeos, underpinning this package\nwill retire shortly. Please refer to R-spatial evolution reports on\nhttps://r-spatial.org/r/2023/05/15/evolution4.html for details.\nThis package is now running under evolution status 0 \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPlease note that rgdal will be retired during October 2023,\nplan transition to sf/stars/terra functions using GDAL and PROJ\nat your earliest convenience.\nSee https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution\nrgdal: version: 1.6-7, (SVN revision 1203)\nGeospatial Data Abstraction Library extensions to R successfully loaded\nLoaded GDAL runtime: GDAL 3.4.3, released 2022/04/22\nPath to GDAL shared files: /usr/share/gdal\nGDAL binary built with GEOS: TRUE \nLoaded PROJ runtime: Rel. 8.2.0, November 1st, 2021, [PJ_VERSION: 820]\nPath to PROJ shared files: /home/luisd/.local/share/proj:/usr/share/proj\nPROJ CDN enabled: FALSE\nLinking to sp version:1.6-1\nTo mute warnings of possible GDAL/OSR exportToProj4() degradation,\nuse options(\"rgdal_show_exportToProj4_warnings\"=\"none\") before loading sp or rgdal.\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.3, PROJ 8.2.0; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(caper)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: ape\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: MASS\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: mvtnorm\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at /home/luisd/Dropbox/darcyDB/PDRF/curso-R-biodiversidad\n```\n:::\n\n```{.r .cell-code}\nlibrary(geiger)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: phytools\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: maps\n```\n:::\n\n```{.r .cell-code}\nlibrary(letsR)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: raster\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'raster'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:geiger':\n\n    hdr\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:MASS':\n\n    select\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPlease note that 'maptools' will be retired during October 2023,\nplan transition at your earliest convenience (see\nhttps://r-spatial.org/r/2023/05/15/evolution4.html and earlier blogs\nfor guidance);some functionality will be moved to 'sp'.\n Checking rgeos availability: TRUE\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nrgeos version: 0.6-3, (SVN revision 696)\n GEOS runtime version: 3.10.2-CAPI-1.16.0 \n Please note that rgeos will be retired during October 2023,\nplan transition to sf or terra functions using GEOS at your earliest convenience.\nSee https://r-spatial.org/r/2023/05/15/evolution4.html for details.\n GEOS using OverlayNG\n Linking to sp version: 1.6-1 \n Polygon checking: TRUE \n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(spdep)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: spData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nTo access larger datasets in this package, install the spDataLarge\npackage with: `install.packages('spDataLarge',\nrepos='https://nowosad.github.io/drat/', type='source')`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'spdep':\n  method   from\n  plot.mst ape \n```\n:::\n\n```{.r .cell-code}\nlibrary(spatialreg)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: Matrix\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'spatialreg'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:spdep':\n\n    get.ClusterOption, get.coresOption, get.mcOption,\n    get.VerboseOption, get.ZeroPolicyOption, set.ClusterOption,\n    set.coresOption, set.mcOption, set.VerboseOption,\n    set.ZeroPolicyOption\n```\n:::\n:::\n\n\n\n## \n\nCargar los datos de registros de Icteridae (obtenidos de GBIF)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict<-read.csv(here(\"data\",\"ict.csv\"),header=T)\n```\n:::\n\n\n\n. . .\n\nLimpiar los registros, asegurándonos que no haya ningún NA ni registros repetidos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict<-na.omit(ict)\nict<-unique(ict)\nnames(ict)<-c(\"taxon\",\"x\",\"y\")\n```\n:::\n\n\n\n. . .\n\nFinalmente, cambiaremos los espacios por guiones bajos en los nombres de las especies. Esto con el fin de que puedan ser reconocidas al momento de utilizar alguna filogenía\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nict$taxon<-gsub(\" \",\"_\",ict$taxon)\nhead(ict)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                taxon        x       y\n1     Icterus_wagleri -96.8249 17.1452\n2        Cacicus_cela -80.7952 -1.6779\n3 Icterus_graduacauda -96.8522 17.1685\n4   Icterus_parisorum -96.8249 17.1452\n5     Sturnella_magna -96.7706 17.1733\n6     Icterus_wagleri -96.8522 17.1685\n```\n:::\n:::\n\n\n\n## \n\nHabiendo cargado y limpiado los registros, podemos obtener los atributos de interés para evaluar la regla de Rapoport en esta familia de aves. Para esto necesitamos saber el área de distribución de las especies y su ubicación geográfica.\n\n. . .\n\nUsando `letsR`, primero, creamos una matriz de presencia-ausencia\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npresab<-lets.presab.points(cbind(ict$x,ict$y),ict$taxon)\n```\n:::\n\n\n\n. . .\n\nDespués, obtenemos el área de distribución de las especies\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nranges<-lets.rangesize(presab)\nhead(ranges)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     Range_size\nAgelaioides_badius           36\nAgelaius_phoeniceus         269\nAgelaius_tricolor            12\nAgelaius_xanthomus            1\nAgelasticus_cyanopus          4\nAgelasticus_thilius          15\n```\n:::\n:::\n\n\n\n## \n\nFinalmente, necesitamos la ubicación de las especies.\n\nAfortunadamente, `letsR` posee una práctica función que permite obtener el punto medio de la ubicación geográfica de las especies\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmidp<-lets.midpoint(presab)\nhead(midp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Species          x         y\n1   Agelaioides_badius  -64.90127 -31.71035\n2  Agelaius_phoeniceus  -97.27983  30.32207\n3    Agelaius_tricolor -121.17026  36.84573\n4   Agelaius_xanthomus  -67.50000  17.50000\n5 Agelasticus_cyanopus  -57.50000 -28.50118\n6  Agelasticus_thilius  -58.16536 -34.17206\n```\n:::\n:::\n\n\n\n## \n\nAhora que tenemos los datos, podemos poner a prueba la relación esperada por la Regla de Rapoport\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nletsrap<-lm(log(ranges)~abs(midp$y))\nsummary(letsrap)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = log(ranges) ~ abs(midp$y))\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.8064 -1.0526  0.2179  0.9897  2.7981 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.14109    0.29532   3.864 0.000235 ***\nabs(midp$y)  0.05460    0.01252   4.361 4.07e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.233 on 75 degrees of freedom\nMultiple R-squared:  0.2023,\tAdjusted R-squared:  0.1916 \nF-statistic: 19.01 on 1 and 75 DF,  p-value: 4.074e-05\n```\n:::\n:::\n\n\n\n## \n\nLa relación entre el área de distribución y la latitud es significativamente postiva en *Icteridae* ahora observemosla de manera más gráfica:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndfram<-data.frame(midp,ranges);names(dfram)<-c(\"sp\",\"x\",\"y\",\"ranges\")\np<-ggplot(dfram,aes(abs(y),log(ranges)))+\n            geom_point(color=\"black\")+\n            xlab(\"Latitud absoluta\")+\n            ylab(\"Log (tamaño área)\")+\n            geom_smooth(method= lm , color=\"red\", fill=\"#69b3a2\", se=TRUE)+\n            theme_classic()\n\nplot(p)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](5.2-regla_ecogeografica_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n## \n\nAhora utilicemos el paquete `epm` para tratar de hacer lo mismo. `epm` no puede utilizar sòlo los puntos de longitud y latitud de nuestros registros, primero hay que transformar esos puntos en un \"spatial feature\"\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsp_ict<-st_as_sf(ict, coords = c(\"x\",\"y\"), crs= st_crs(\"+datum=WGS84 +proj=longlat\"))\nhead(sp_ict)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 1 field\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -96.8522 ymin: -1.6779 xmax: -80.7952 ymax: 17.1733\nGeodetic CRS:  +datum=WGS84 +proj=longlat\n                taxon                 geometry\n1     Icterus_wagleri POINT (-96.8249 17.1452)\n2        Cacicus_cela POINT (-80.7952 -1.6779)\n3 Icterus_graduacauda POINT (-96.8522 17.1685)\n4   Icterus_parisorum POINT (-96.8249 17.1452)\n5     Sturnella_magna POINT (-96.7706 17.1733)\n6     Icterus_wagleri POINT (-96.8522 17.1685)\n```\n:::\n:::\n\n\n\n## \n\nAhora que nuestros registros son un objeto espacial, ya podemos utilizar `epm` para crear un grid con nuestras especies en el espacio:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrix<-createEPMgrid(sp_ict,resolution = 1)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\tDetected 77 taxa with point data.\n```\n:::\n:::\n\n\n\n. . .\n\nCon este grid, ya podemos obtener el área de distribución de las especies, dónde cell es área de distribución\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCellcount<-data.frame(grix$cellCount)\nnames(Cellcount)<-\"cell\"\nhead(Cellcount)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     cell\nAgelaioides_badius     36\nAgelaius_phoeniceus   287\nAgelaius_tricolor      12\nAgelaius_xanthomus      1\nAgelasticus_cyanopus    4\nAgelasticus_thilius    15\n```\n:::\n:::\n\n\n\n## \n\n¿Qué tanto se parece la distribución calculada con `letsR` a la calculada con `epm`?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,2))\nhist(dfram$ranges, breaks=15, main =\"LetsR\", xlab=\"área de distribución\",ylab=\"especies\")\nhist(Cellcount$cell, breaks =15, main= \"EPM\", xlab =\"área de distribución\",ylab=\"especies\")\n```\n\n::: {.cell-output-display}\n![](5.2-regla_ecogeografica_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n## \n\nPara la ubicación geográfica de las especies, en el caso de `epm` no se cuenta con una función especifica para obtener los puntos medios de la distribución de las especies.\n\nPor lo tanto, tenemos que cargar una función personalizada:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(here(\"data\",\"st_midpoints.R\"))\n```\n:::\n\n\n\n. . . Esta función utiliza la nueva paquetería `sf` para crear un polígono para cada especie con todas las coordenadas de nuestros registros, para posteriormente calcular el centroide de dicho polígono, obteniendo así los puntos medios de la ubicación geográfica de nuestras especies.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmidst<-st_midpoints(ict)\nhead(midst)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     sp          X         Y\n55   Agelaioides_badius  -53.18129 -22.92205\n18  Agelaius_phoeniceus  -97.27558  30.89165\n44    Agelaius_tricolor -119.04709  35.69512\n73   Agelaius_xanthomus  -67.11699  17.95263\n15 Agelasticus_cyanopus  -53.72550 -21.23416\n26  Agelasticus_thilius  -65.57207 -26.82030\n```\n:::\n:::\n\n\n\n## \n\nAhora ya tenemos los datos necesarios para evaluar la relación esperada por la Regla de Rapoport\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm(log(Cellcount$cell)~abs(midst$Y)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = log(Cellcount$cell) ~ abs(midst$Y))\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.98520 -0.72200  0.07052  0.86243  2.81757 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   1.19213    0.28009   4.256 5.94e-05 ***\nabs(midst$Y)  0.05903    0.01278   4.620 1.56e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.212 on 75 degrees of freedom\nMultiple R-squared:  0.2216,\tAdjusted R-squared:  0.2112 \nF-statistic: 21.35 on 1 and 75 DF,  p-value: 1.56e-05\n```\n:::\n:::\n\n\n\n## \n\n-   El resultado es una relación significativamente postiva en *Icteridae* entre el área de distribución y la latitud.\n\n-   Esta relación es muy parecida a la obtenida utilizando el procedimiento `letsR`. Las diferencias observadas pueden deberse a 1) el cálculo de los grids, pues `letsR` utiliza celdas y nosotros calculamos hexagonos con `epm` o 2) el cálculo de los puntos medios, pues para `epm` dicho cálculo es más o menos artesanal.\n\n-   Ahora que hemos evaluado la regla de Rapoport utilizando dos métodos y paqueterías distintas, podemos pensar en el efecto del componente evolutivo sobre dicha relación.\n\n## \n\nPara esto, primero debemos cargar una filogenía para nuestras especies. En este caso utilizaremos una filogenía para *Icteridae*, cortada de la filogenía para *Emberizoidea*, usada en Arango et al., 2022, modificada y estandarizada de Barker et al., 2015.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntre<-read.tree(here(\"data\",\"Icteridae_tree.txt\"))\ntre\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nPhylogenetic tree with 100 tips and 99 internal nodes.\n\nTip labels:\n  Icterus_melanopsis, Icterus_northropi, Icterus_laudabilis, Icterus_dominicensis, Icterus_cayanensis, Icterus_pyrrhopterus, ...\nNode labels:\n  761, 762, 763, 764, 765, 766, ...\n\nRooted; includes branch lengths.\n```\n:::\n:::\n\n\n\n## \n\nAhora crearemos un *data.frame* el cual contenga el área de distribución y los puntos medios para cada especie. Para motivos del ejercicio, haremos uso de los resultados obtenidos con `epm`. ¡Pero ustedes pueden hacerlo con los resultados obtenidos con `letsR` y podemos comparar las relaciones finales!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrapp<-data.frame(midst,Cellcount$cell,row.names = NULL);names(rapp)<-c(\"sp\",\"x\",\"y\",\"area\")\nhead(rapp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    sp          x         y area\n1   Agelaioides_badius  -53.18129 -22.92205   36\n2  Agelaius_phoeniceus  -97.27558  30.89165  287\n3    Agelaius_tricolor -119.04709  35.69512   12\n4   Agelaius_xanthomus  -67.11699  17.95263    1\n5 Agelasticus_cyanopus  -53.72550 -21.23416    4\n6  Agelasticus_thilius  -65.57207 -26.82030   15\n```\n:::\n:::\n\n\n\n## \n\nUna vez que tenemos nuestra tabla de datos, creamos un objeto *comparative.data*, el cual juntará nuestros datos geográficos con nuestros datos filogenéticos\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompict<-comparative.data(tre,data =rapp,names.col = \"sp\",vcv = T)\n```\n:::\n\n\n\n## \n\nAhora ya podemos ajustar un modelo de regresión considerando las relaciones filogenéticas de nuestras especies utilizando un PGLS (*P*hylogenetic *G*eneralized *L*east *S*quares):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraprule<-pgls(log(area)~abs(y),data=compict,lambda=\"ML\")\nsummary(raprule)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\npgls(formula = log(area) ~ abs(y), data = compict, lambda = \"ML\")\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.07514 -0.24240  0.00397  0.16635  0.76134 \n\nBranch length transformations:\n\nkappa  [Fix]  : 1.000\nlambda [ ML]  : 0.000\n   lower bound : 0.000, p = 1    \n   upper bound : 1.000, p = 4.5519e-14\n   95.0% CI   : (NA, 0.651)\ndelta  [Fix]  : 1.000\n\nCoefficients:\n            Estimate Std. Error t value  Pr(>|t|)    \n(Intercept) 1.274120   0.296186  4.3018 5.551e-05 ***\nabs(y)      0.057690   0.013493  4.2755 6.093e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3893 on 68 degrees of freedom\nMultiple R-squared: 0.2119,\tAdjusted R-squared: 0.2003 \nF-statistic: 18.28 on 1 and 68 DF,  p-value: 6.093e-05 \n```\n:::\n:::\n\n\n\n## \n\n¡La relación se mantiene!\n\n-   Ahora, si bien es mucho más fácil obtener estos resultados utlizando `letsR`, `epm` hace uso de las nuevas paqueterías espaciales, además de servir para mapear otros componentes de diversidad y macroevolución.\n\n-   Por ejemplo, podemos obtener la diversidad filogenética (PD), las tasas de diversificación (DR) y los endemismos filogenéticos de cada comunidad (o celda) y responder preguntas que involucren métricas de este tipo y la geografía.\n\n## \n\nPara esto, primero debemos agregarle una filogenía a nuestro grid creado con `epm`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrix<-epm::addPhylo(grix,tre)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in epm::addPhylo(grix, tre): 30 species were pruned from the phylogeny because they lack geographic data.\n```\n:::\n:::\n\n\n\n. . .\n\nYa con la filogenía incorporada a nuestro grid de `epm`, calculamos para cada celda PD:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npd<-gridMetrics(grix,\"pd\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...dropping species that are not in phylo data...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...calculating phylo metric: pd...\n```\n:::\n:::\n\n\n\n## \n\nAdemás, podemos calcular otras métricas 'evolutivas' como la tasa de diversificación y los endemismos filogenéticos\n\n. . .\n\nTasa de especiación\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndr<-gridMetrics(grix,\"DR\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...dropping species that are not in phylo data...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...calculating phylo metric: DR...\n```\n:::\n:::\n\n\n\n. . .\n\nEndemismo filogenético\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphyendm<-gridMetrics(grix,\"phyloWeightedEndemism\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...dropping species that are not in phylo data...\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\t...calculating phylogenetic weighted endemism...\n```\n:::\n:::\n\n\n\n## \n\nVeamos estas métricas mapeadas en el espacio geográfico\n\n. . .\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,3))\nplot(pd,use_tmap=F, legend=F)\naddLegend(pd,location=\"left\",label = \"PD\")\nplot(dr,use_tmap=F, legend=F)\naddLegend(dr,location=\"left\",label = \"DR\")\nplot(phyendm,use_tmap=F, legend=F)\naddLegend(phyendm,location=\"left\",label = \"Phyloendemisms\")\n```\n\n::: {.cell-output-display}\n![](5.2-regla_ecogeografica_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n## \n\nCon estos datos, podemos hacernos preguntas cómo: ¿Las comunidades que poseen mayores tasas de diversificación tienen una mayor diversidad filogenética?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm(pd$grid$pd~dr$grid$DR))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = pd$grid$pd ~ dr$grid$DR)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-11.580  -8.297  -3.003   5.778  48.604 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  17.0500     0.9138  18.658   <2e-16 ***\ndr$grid$DR    3.9509     1.8877   2.093   0.0367 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 10.79 on 738 degrees of freedom\n  (27 observations deleted due to missingness)\nMultiple R-squared:  0.005901,\tAdjusted R-squared:  0.004554 \nF-statistic: 4.381 on 1 and 738 DF,  p-value: 0.03669\n```\n:::\n:::\n\n\n\n## \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(dr$grid$DR,pd$grid$pd,xlab=\"Tasa de diversificación\",ylab=\"Diversidad filogenética\", pch=16)\n```\n\n::: {.cell-output-display}\n![](5.2-regla_ecogeografica_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n## \n\n¿Los endemismos filognéticos siguen un patrón de gradiente latitudinal?\n\n. . .\n\nObtengamos las coordenadas de cada celda y su valor de filoendemismos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrdtemp<-grix$grid$gridTemplate\nstcen<-st_centroid(grdtemp)\nstcoor<-st_coordinates(stcen)\ncoordsx<-as.data.frame(stcoor)\nphylem<-as.data.frame(phyendm$grid$phyloWeightedEndemism)\nendmcoords<-cbind(coordsx,phylem); names(endmcoords)<-c(\"x\",\"y\",\"phyloendemism\")\nendmcoords<-na.omit(endmcoords)\nhead(endmcoords)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          x        y phyloendemism\n1 -132.1468 54.27687    0.05185643\n2 -124.6468 43.01901    0.05185643\n3 -124.1468 40.42101    0.07705955\n4 -124.1468 43.88501    0.07705955\n5 -124.1468 45.61700    0.07242206\n6 -124.1468 49.08097    0.07242206\n```\n:::\n:::\n\n\n\n## \n\nAhora, pongamos a prueba la pregunta:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlatendm<-lm(log(phyloendemism)~abs(y),data= endmcoords)\nsummary(latendm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = log(phyloendemism) ~ abs(y), data = endmcoords)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.1211 -0.7451 -0.0409  0.6642  3.3798 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -0.515137   0.099321  -5.187 2.77e-07 ***\nabs(y)      -0.049390   0.003193 -15.467  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.03 on 738 degrees of freedom\nMultiple R-squared:  0.2448,\tAdjusted R-squared:  0.2438 \nF-statistic: 239.2 on 1 and 738 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n## \n\nParece que los endemismos disminuyen al alejarse del ecuador, siguiendo un gradiente latitudinal. Observémoslo:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2<-ggplot(endmcoords,aes(abs(y),log(phyloendemism)))+\n            geom_point(color=\"black\")+\n            xlab(\"Latitud absoluta\")+\n            ylab(\"log (Filoendemismos)\")+\n            geom_smooth(method= lm , color=\"red\", fill=\"#69b3a2\", se=TRUE)+\n            theme_classic()\n\nplot(p2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](5.2-regla_ecogeografica_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\n. . .\n\n¿Qué podemos concluir de esto?\n",
    "supporting": [
      "5.2-regla_ecogeografica_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}